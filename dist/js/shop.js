"use strict";$(function(){(new function(){this.init=function(){this.checkCookie()?(this.loadMsg(),this.btnAdd=!0):(alert("请先登录"),location.href="./index.html")},this.checkCookie=function(){var t=getCookie(document.cookie,"username");return!!t&&($(".nav-register").css("display","none"),$(".nav-login").text("欢迎您，"+t).css("width","160"),!0)},this.addEvent=function(t){this.btnAddNum=$(".btn.btn-success"),this.btnReduceNum=$(".btn.btn-warning"),this.btnMoveFromCar=$(".btn.btn-danger"),this.textMsg=$(".proName");var n=this;this.textMsg.click(function(){location.href="./message.html"}),this.product=$("table tr");for(var e=1;e<this.product.length-1;e++)this.product.eq(e).attr("uid",t[e-1].product_id);this.btnAddNum.click(function(){$(this).prev().text(parseInt($(this).prev().text())+1),n.refreshPrice("add",$(this).parent().prev().prev().text());var t=$(this).parent().parent().attr("uid");n.ajax(t,"add","../interface/updatewq.php")}),this.btnReduceNum.click(function(){if($(this).next().text(parseInt($(this).next().text())-1),n.refreshPrice("cut",$(this).parent().prev().prev().text()),0==$(this).next().text())if(n.checkNum($(this)))$(this).next().text(parseInt($(this).next().text())+1),n.refreshPrice("add",$(this).parent().prev().prev().text());else{var t=$(this).parent().parent().attr("uid"),e="../interface/delwq.php";n.ajax(t,"",e)}else t=$(this).parent().parent().attr("uid"),e="../interface/updatewq.php",n.ajax(t,"cut",e)}),this.btnMoveFromCar.click(function(){if(confirm("此操作不可逆，是否确定要移出购物车？")){n.refreshPrice("del",$(this).parent().prev().prev().prev().text(),$(this).parent().prev().children().eq(1).text()),$(this).parent().parent().css("display","none"),$(this).parent().prev().children().eq(1).text(0);var t=$(this).parent().parent().attr("uid");n.ajax(t,"","../interface/delwq.php")}}),this.checkNum=function(t){if(!confirm("要将商品移除吗？"))return!0;t.parent().next().children().eq(0).trigger("click")},this.ajax=function(t,e,n){var r="?id="+t+"&type="+e;$.ajax({url:n+r,dataType:"jsonp",success:function(t){}})},this.refreshPrice=function(t,e,n){e=parseFloat(e.slice(1)),console.log(t,e,n,$(".totalPrice").text()),"add"==t?$(".totalPrice").text("¥"+(parseFloat($(".totalPrice").text().slice(1))+e).toFixed(2)):"cut"==t?$(".totalPrice").text("¥"+(parseFloat($(".totalPrice").text().slice(1))-e).toFixed(2)):$(".totalPrice").text("¥"+(parseFloat($(".totalPrice").text().slice(1))-e*n).toFixed(2))}};var i=this;this.loadMsg=function(){$.ajax({url:"../interface/showlist.php",dataType:"jsonp",success:function(t){t=t.data;var e='<tr style="display: table-row;">\n                    <th>商品图片</th>\n                    <th>商品名</th>\n                    <th>商品价格</th>\n                    <th>商品规格</th>\n                    <th>商品数量</th>\n                    <th>移出购物车</th>\n                </tr>',n=0;for(var r in t)n+=t[r].product_price*t[r].product_num,e+='<tr>\n                        <th>\n                            <img src="'.concat(t[r].product_img,'" alt="">\n                        </th>\n                        <td class="proName">').concat(t[r].product_name,"</td>\n                        <td>¥").concat(t[r].product_price,"</td>\n                        <td>").concat(t[r].product_guige,'</td>\n                        <td>\n                            <button class="btn btn-warning">-</button>\n                            <em>').concat(t[r].product_num,'</em>\n                            <button class="btn btn-success">+</button>\n                        </td>\n                        <td>\n                            <button class="btn btn-danger">移出购物车</button>\n                        </td>\n                    </tr>');e+='<tr style="display: table-row;">\n                    <th colspan="3" class="white"></th>\n                    <th>总价</th>\n                    <th class="totalPrice">¥'.concat(n.toFixed(2),'</th>\n                    <th class="btn btn-primary" style="width: 110px">结算</th>\n                </tr>'),$("table").html(e),i.addEvent(t)}})}}).init()});